<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Main logging schema for qlog</title>

  
<style type="text/css">/*<![CDATA[*/

body {
  font: 16px "Helvetica Neue","Open Sans",Helvetica,Calibri,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 24px;
  margin: 75px auto;
  max-width: 624px;
  padding: 0 5px;
}

.title, .filename, h1, h2, h3, h4, h5 {
  font: 16px "Roboto Condensed","Helvetica Neue","Open Sans",Helvetica,Calibri,sans-serif;
  font-size-adjust: 0.5;
  font-weight: bold;
  color: #333;
  line-height: 100%;
  margin: 1.2em 0 0.3em;
}
.title, #rfc\.title h1 { font-size: 32px; }
h1, section h1, h2, section h2, section h3, nav h2 { font-size: 20px; }
h3, section h4, h4, section h5 { font-size: 16px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header, table#rfc\.headerblock {
  width: 100%;
}
table.header td, table#rfc\.headerblock td {
  border: none;
  background-color: transparent;
  color: black;
  padding: 0;
}
.filename {
  display: block;
  color: rgb(119, 119, 119);
  font-size: 20px;
  font-weight: normal;
  line-height: 100%;
  margin: 10px 0 32px;
}
#rfc\.abstract+p, #rfc\.abstract+p code, #rfc\.abstract+p samp, #rfc\.abstract+p tt {
  font-size: 20px;
  line-height: 28px;
}

samp, tt, code, pre, span.tt {
  font-size: 13.5px;
  font-family: Consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure, caption {
  font-style: italic;
  margin: 0 1.5em;
  text-align: left;
}

address {
  margin: 16px 2px;
  line-height: 20px;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn, address b {
  font-weight: normal;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}
hr.noprint {
  display: none;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

p, ol, ul, li {
  padding: 0;
}
p {
  margin: 0.5em 0;
}
ol, ul {
  margin: 0.2em 0 0.2em 2em;
}
li {
  margin: 0.2em 0;
}
address {
  font-style: normal;
}

ul.toc ul {
  margin: 0 0 0 2em;
}
ul.toc li {
  list-style: none;
  margin: 0;
}

@media screen and (min-width: 924px) {
  body {
    padding-right: 350px;
  }
  body>ul.toc, body>#rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    z-index: 1;
    overflow: auto;
    overscroll-behavior: contain;
  }
  body>#rfc\.toc {
    top: 55px;
  }
  body>ul.toc {
    top: 100px;
  }

  ul.toc {
    margin: 0 0 0 4px;
    font-size: 12px;
    line-height: 20px;
  }
  ul.toc ul {
    margin-left: 1.2em;
  }
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
  /*]]>*/</style>
  <meta name="viewport" content="initial-scale=1.0">


  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Notational Conventions">
<link href="#rfc.section.2" rel="Chapter" title="2 Design Goals">
<link href="#rfc.section.3" rel="Chapter" title="3 The High Level Schema">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Top level container">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Summary field">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Trace container">
<link href="#rfc.section.3.3.1" rel="Chapter" title="3.3.1 vantage_point">
<link href="#rfc.section.3.3.2" rel="Chapter" title="3.3.2 Title and Description">
<link href="#rfc.section.3.3.3" rel="Chapter" title="3.3.3 Configuration">
<link href="#rfc.section.3.3.4" rel="Chapter" title="3.3.4 common_fields and event_fields">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Field name semantics">
<link href="#rfc.section.3.4.1" rel="Chapter" title="3.4.1 time, delta_time and reference_time + relative_time">
<link href="#rfc.section.3.4.2" rel="Chapter" title="3.4.2 group_id and group_ids">
<link href="#rfc.section.3.4.3" rel="Chapter" title="3.4.3 category and event">
<link href="#rfc.section.3.4.4" rel="Chapter" title="3.4.4 data">
<link href="#rfc.section.3.4.5" rel="Chapter" title="3.4.5 Event field values">
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 triggers">
<link href="#rfc.section.4" rel="Chapter" title="4 Tooling requirements">
<link href="#rfc.section.5" rel="Chapter" title="5 Methods of Access">
<link href="#rfc.section.6" rel="Chapter" title="6 Notes on Practical Use">
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations">
<link href="#rfc.references" rel="Chapter" title="9 Normative References">
<link href="#rfc.appendix.A" rel="Chapter" title="A Change Log">
<link href="#rfc.appendix.A.1" rel="Chapter" title="A.1 Since draft-marx-qlog-main-schema-00:">
<link href="#rfc.appendix.B" rel="Chapter" title="B Design Variations">
<link href="#rfc.appendix.C" rel="Chapter" title="C Acknowledgements">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.31.0 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Marx, R." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-marx-qlog-main-schema-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2019-10-08" />
  <meta name="dct.abstract" content="This document describes a high-level schema for a standardized endpoint logging format called qlog.  This format allows easy sharing of data and the creation of reusable visualization and debugging tools. The high-level schema in this document is intended to be protocol-agnostic. Separate documents specify how the format should be used for specific protocol data." />
  <meta name="description" content="This document describes a high-level schema for a standardized endpoint logging format called qlog.  This format allows easy sharing of data and the creation of reusable visualization and debugging tools. The high-level schema in this document is intended to be protocol-agnostic. Separate documents specify how the format should be used for specific protocol data." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">QUIC</td>
<td class="right">R. Marx</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Hasselt University</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">October 08, 2019</td>
</tr>
<tr>
<td class="left">Expires: April 10, 2020</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Main logging schema for qlog<br />
  <span class="filename">draft-marx-qlog-main-schema-latest</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document describes a high-level schema for a standardized endpoint logging format called qlog.  This format allows easy sharing of data and the creation of reusable visualization and debugging tools. The high-level schema in this document is intended to be protocol-agnostic. Separate documents specify how the format should be used for specific protocol data.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 10, 2020.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2019 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Notational Conventions</a>
</li>
</ul><li>2.   <a href="#rfc.section.2">Design Goals</a>
</li>
<li>3.   <a href="#rfc.section.3">The High Level Schema</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Top level container</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Summary field</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Trace container</a>
</li>
<ul><li>3.3.1.   <a href="#rfc.section.3.3.1">vantage_point</a>
</li>
<li>3.3.2.   <a href="#rfc.section.3.3.2">Title and Description</a>
</li>
<li>3.3.3.   <a href="#rfc.section.3.3.3">Configuration</a>
</li>
<li>3.3.4.   <a href="#rfc.section.3.3.4">common_fields and event_fields</a>
</li>
</ul><li>3.4.   <a href="#rfc.section.3.4">Field name semantics</a>
</li>
<ul><li>3.4.1.   <a href="#rfc.section.3.4.1">time, delta_time and reference_time + relative_time</a>
</li>
<li>3.4.2.   <a href="#rfc.section.3.4.2">group_id and group_ids</a>
</li>
<li>3.4.3.   <a href="#rfc.section.3.4.3">category and event</a>
</li>
<li>3.4.4.   <a href="#rfc.section.3.4.4">data</a>
</li>
<li>3.4.5.   <a href="#rfc.section.3.4.5">Event field values</a>
</li>
</ul><li>3.5.   <a href="#rfc.section.3.5">triggers</a>
</li>
</ul><li>4.   <a href="#rfc.section.4">Tooling requirements</a>
</li>
<li>5.   <a href="#rfc.section.5">Methods of Access</a>
</li>
<li>6.   <a href="#rfc.section.6">Notes on Practical Use</a>
</li>
<li>7.   <a href="#rfc.section.7">Security Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a>
</li>
<li>9.   <a href="#rfc.references">Normative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.A">Change Log</a>
</li>
<ul><li>A.1.   <a href="#rfc.appendix.A.1">Since draft-marx-qlog-main-schema-00:</a>
</li>
</ul><li>Appendix B.   <a href="#rfc.appendix.B">Design Variations</a>
</li>
<li>Appendix C.   <a href="#rfc.appendix.C">Acknowledgements</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">Feedback and discussion welcome at https://github.com/quiclog/internet-drafts</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#notational-conventions" id="notational-conventions">Notational Conventions</a>
</h1>
<p id="rfc.section.1.1.p.1">The key words &#8220;MUST&#8221;, &#8220;MUST NOT&#8221;, &#8220;REQUIRED&#8221;, &#8220;SHALL&#8221;, &#8220;SHALL NOT&#8221;, &#8220;SHOULD&#8221;, &#8220;SHOULD NOT&#8221;, &#8220;RECOMMENDED&#8221;, &#8220;MAY&#8221;, and &#8220;OPTIONAL&#8221; in this document are to be interpreted as described in <a href="#RFC2119" class="xref">[RFC2119]</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#design-goals" id="design-goals">Design Goals</a>
</h1>
<p id="rfc.section.2.p.1">The main tenets for the schema design are:</p>
<p></p>

<ul>
<li>Streamable, event-based</li>
<li>Flexibility in the format, complexity in the tooling (e.g., few components are a MUST, tools need to deal with this)</li>
<li>Extensible but pragmatic (e.g., no complex fixed schema with extension points)</li>
<li>Aggregation and transformation friendly (e.g., the top-level element is a container for individual traces)</li>
<li>Explicit and human-readable</li>
</ul>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#the-high-level-schema" id="the-high-level-schema">The High Level Schema</a>
</h1>
<p id="rfc.section.3.p.1">TODO: add proper data definitions for all fields (e.g., enums, strings vs numbers, etc. similar to what we have in the other document). For now, if in doubt, refer to https://github.com/quiclog/qlog/blob/master/TypeScript/draft-01/QLog.ts</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#top-level-container" id="top-level-container">Top level container</a>
</h1>
<p id="rfc.section.3.1.p.1">To allow separate qlog traces to be contained within a single, encompassing qlog file, the top-level element in the qlog schema defines only a small set of fields and an array of component traces. Only the &#8220;qlog_version&#8221; and &#8220;traces&#8221; fields MUST be present. For this document, the &#8220;qlog_version&#8221; field MUST have a value of draft-00.</p>
<div id="rfc.figure.1"></div>
<div id="top_element"></div>
<pre>
{
    "qlog_version": "draft-00",
    "title": "Name of this particular qlog file (short)",
    "description": "Description for this group of traces (long)",
    "summary": {
        ...
    }
    "traces": [...]
}
</pre>
<p class="figure">Figure 1: Top-level element</p>
<p id="rfc.section.3.1.p.2">Typical logs will only contain a single element in the &#8220;traces&#8221; array. Multiple traces can then be combined into a single qlog file by taking the &#8220;traces&#8221; entries for each qlog file individually and copying them to the &#8220;traces&#8221; array of a new, aggregated qlog file. This is typically done in a post-processing step.</p>
<p id="rfc.section.3.1.p.3">For example, for a test setup, we perform logging on the client, on the server and on a single point on their common network path. Each of these three logs is first created separately during the test. Afterwards, the three logs can be aggregated into a single qlog file.</p>
<p id="rfc.section.3.1.p.4">As such, the &#8220;traces&#8221; array can also contain &#8220;error&#8221; entries. These indicate that we tried to find/convert a file for inclusion in the aggregated qlog, but there was an error during the process. Rather than silently dropping the erroneous file, we explicitly include it in the qlog file.</p>
<p id="rfc.section.3.1.p.5">TODO: add proper data definitions of what the &#8220;error&#8221; should look like ~~~ interface IError { error_description: string, uri: string } ~~~</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#summary-field" id="summary-field">Summary field</a>
</h1>
<p id="rfc.section.3.2.p.1">In a real-life deployment with a large amount of generated logs, it can be useful to sort and filter logs based on some basic summarized or aggregated data (e.g., log length, packet loss rate, log location, &#8230;). The summary field (if present) SHOULD be on top of the qlog file, as this allows for the file to be processed in a streaming fashion (i.e., the implementation could just read up to and including the summary field and then only load the full logs that are deemed interesting by the user).</p>
<p id="rfc.section.3.2.p.2">As the summary field is highly deployment-specific, this document does not specify any default fields or their semantics. Some examples of potential entries are:</p>
<pre>
"summary": {
    "trace_count":number, // amount of traces in this file
    "max_duration":string, // time duration of the longest trace
    "max_outgoing_loss_rate":number, // highest loss rate for outgoing packets over all traces
    "total_event_count":number // total number of events across all traces
}
</pre>
<p></p>

<ul>
<li>TODO: are there any field semantics we should specify here?</li>
<li>TODO: Will people actually use this? or will they store this info out-of-band (e.g., separate database for faster querying?)</li>
</ul>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#trace-container" id="trace-container">Trace container</a>
</h1>
<p id="rfc.section.3.3.p.1">Each trace container encompasses a single conceptual trace. The exact definition of a trace can be fluid. For example, a trace could contain all events for a single connection, for a single endpoint, for a single measurement interval, &#8230;</p>
<p id="rfc.section.3.3.p.2">In the normal use case, a trace is a log of a single data flow collected at a single location or vantage point. For example, for QUIC, a single trace only contains events for a single logical QUIC connection. However, a single trace could also combine events from a variety of vantage points or use cases (e.g., multiple QUIC connections or the same connection viewed from different points in the network).</p>
<p id="rfc.section.3.3.p.3">The semantics and context of the trace can be deduced from the entries in the &#8220;common_fields&#8221; (specifically the &#8220;group_ids&#8221; field) and &#8220;event_fields&#8221; lists.</p>
<p id="rfc.section.3.3.p.4">Only the &#8220;event_fields&#8221; and &#8220;events&#8221; fields MUST be present.</p>
<div id="rfc.figure.2"></div>
<div id="trace_container"></div>
<pre>
{
    "vantage_point": {
        "name": "backend-67",
        "type": "server"
    },
    "title": "Name of this particular trace (short)",
    "description": "Description for this trace (long)",
    "configuration": {
        "time_offset": "offset in ms",
        "time_units": "ms" | "us"
    },
    "common_fields": (see below),
    "event_fields": (see below),
    "events": [...]
}
</pre>
<p class="figure">Figure 2: Trace container</p>
<h1 id="rfc.section.3.3.1">
<a href="#rfc.section.3.3.1">3.3.1.</a> <a href="#vantagepoint" id="vantagepoint">vantage_point</a>
</h1>
<p id="rfc.section.3.3.1.p.1">This field describes the vantage point from which the trace originates.  Its value is an object, with the following fields:</p>
<p></p>

<ul>
<li>name: an optional, user-chosen string (e.g., &#8220;NETWORK-1&#8221;, &#8220;loadbalancer45&#8221;, &#8220;reverseproxy@192.168.1.1&#8221;, &#8230;)</li>
<li>type: one of four values: &#8220;server&#8221;, &#8220;client&#8221;, &#8220;network&#8221; or &#8220;unknown&#8221;.  <ul>
<li>client indicates an endpoint which initiates the connection.</li>
<li>server indicates an endpoint which accepts the connection.</li>
<li>network indicates an observer in between client and server.</li>
<li>unknown indicates the endpoint is unknown.</li>
</ul>
</li>
<li>flow: one of three values: &#8220;client&#8221;, &#8220;server&#8221; or &#8220;unknown&#8221;.  <ul>
<li>This field is only required if type is &#8220;network&#8221;.</li>
<li>client indicates that this vantage point follows client data flow semantics (a packet_sent goes in the direction of the server).</li>
<li>server indicates that this vantage point follow server data flow semantics (a packet_sent goes in the direction of the client).</li>
<li>unknown indicates that the flow is unknown.</li>
</ul>
</li>
</ul>
<p id="rfc.section.3.3.1.p.3">The type field MUST be present. The flow field MUST be present if the type field has value &#8220;network&#8221;. The name field is optional.</p>
<p id="rfc.section.3.3.1.p.4">TODO (see issue 6): &#8220;network&#8221; should have a way to indicate what RX and TX mean (is current way enough? maybe identify endpoints by ID or 4-tuple etc.)</p>
<p id="rfc.section.3.3.1.p.5">TODO: maybe mention what tools should do with &#8220;unknown&#8221;?</p>
<h1 id="rfc.section.3.3.2">
<a href="#rfc.section.3.3.2">3.3.2.</a> <a href="#title-and-description" id="title-and-description">Title and Description</a>
</h1>
<p id="rfc.section.3.3.2.p.1">Both fields&#8217; values are generic strings, used for describing the contents of the trace. These can either be filled in automatically (e.g., showing the endpoint name and readable timestamp of the log), or can be filled manually when creating aggregated logs (e.g., qlog files that illustrate a specific problem across traces that want to include additional explanations for easier communication between teams, students, &#8230;).</p>
<h1 id="rfc.section.3.3.3">
<a href="#rfc.section.3.3.3">3.3.3.</a> <a href="#configuration" id="configuration">Configuration</a>
</h1>
<p id="rfc.section.3.3.3.p.1">We take into account that a log file is usually not used in isolation, but by means of various tools. Especially when aggregating various traces together or preparing traces for a demonstration, one might wish to persist certain tool-based settings inside the log file itself. For this, the configuration field is used.</p>
<p id="rfc.section.3.3.3.p.2">The configuration field can be viewed as a generic metadata field that tools can fill with their own fields, based on per-tool logic. It is best practice for tools to prefix each added field with their tool name to prevent collisions across tools. This document only defines three standard, tool-independent configuration settings: &#8220;time_offset&#8221;, &#8220;time_units&#8221; and &#8220;original_uris&#8221;.</p>
<h1 id="rfc.section.3.3.3.1">
<a href="#rfc.section.3.3.3.1">3.3.3.1.</a> <a href="#timeoffset" id="timeoffset">time_offset</a>
</h1>
<p id="rfc.section.3.3.3.1.p.1">time_offset indicates by how many units of time (see next section) the starting time of the current trace should be offset. This is useful when comparing logs taken from various systems, where clocks might not be perfectly synchronous. Users could use manual tools or automated logic to align traces in time and the found optimal offsets can be stored in this field for future usage.</p>
<h1 id="rfc.section.3.3.3.2">
<a href="#rfc.section.3.3.3.2">3.3.3.2.</a> <a href="#timeunits" id="timeunits">time_units</a>
</h1>
<p id="rfc.section.3.3.3.2.p.1">Since timestamps can be stored in various granularities, this field allows to indicate whether storage happens in either milliseconds (&#8220;ms&#8221;) or microseconds (&#8220;us&#8221;). If this field is not present, the default value is &#8220;ms&#8221;. This configuration setting applies to all other timestamps in the trace file as well, not just the &#8220;time_offset&#8221; field.</p>
<h1 id="rfc.section.3.3.3.3">
<a href="#rfc.section.3.3.3.3">3.3.3.3.</a> <a href="#originaluris" id="originaluris">original_uris</a>
</h1>
<p id="rfc.section.3.3.3.3.p.1">This is an optional parameter used when merging multiple individual qlog files or other source files (e.g., when converting .pcaps to qlog). It allows to keep better track where certain data came from. It is a simple array of strings.</p>
<h1 id="rfc.section.3.3.4">
<a href="#rfc.section.3.3.4">3.3.4.</a> <a href="#commonfields-and-eventfields" id="commonfields-and-eventfields">common_fields and event_fields</a>
</h1>
<p id="rfc.section.3.3.4.p.1">To reduce file size and make logging easier, the trace schema lists the names of the specific fields that are logged per-event up-front, instead of repeating the field name with each value, as is common in traditiona JSON. This is done in the &#8220;event_fields&#8221; list. This allows us to encode individual events as an array of values, instead of an object. To reduce file size even further, common event fields that have the same value for all events in this trace, are listed as name-value pairs in &#8220;common_fields&#8221;.</p>
<p id="rfc.section.3.3.4.p.2">For example, when logging events for a single QUIC connection, all events will share the same &#8220;original destination connection ID&#8221; (ODCID). This field and its value should be set in &#8220;common_fields&#8221;, rather than &#8220;event_fields&#8221;. However, if a single trace would contain events for multiple QUIC connections at the same time (e.g., a single, big output log for a server), the ODCID can be different across events, and SHOULD be part of &#8220;event_fields&#8221;.</p>
<p id="rfc.section.3.3.4.p.3">Examples comparing traditional JSON vs the qlog format can be found in <a href="#traditional_json" class="xref">Figure 3</a> and <a href="#qlog_json" class="xref">Figure 4</a>. The events described in these examples are purely for illustration. Actual event type definitions for the QUIC and HTTP/3 protocols can be found in TODO.</p>
<div id="rfc.figure.3"></div>
<div id="traditional_json"></div>
<pre>
{
    "events": [{
            "group_id": "127ecc830d98f9d54a42c4f0842aa87e181a",
            "ODCID": "127ecc830d98f9d54a42c4f0842aa87e181a",
            "protocol_type": "QUIC_HTTP3",
            "time": 1553986553574,
            "category": "transport",
            "event": "packet_received",
            "data": [...]
        },{
            "group_id": "127ecc830d98f9d54a42c4f0842aa87e181a",
            "ODCID": "127ecc830d98f9d54a42c4f0842aa87e181a",
            "protocol_type": "QUIC_HTTP3",
            "time": 1553986553579,
            "category": "http",
            "event": "frame_parsed",
            "data": [...]
        },
        ...
    ]
}
</pre>
<p class="figure">Figure 3: Traditional JSON</p>
<div id="rfc.figure.4"></div>
<div id="qlog_json"></div>
<pre>
{
    "common_fields": {
        "group_id": "127ecc830d98f9d54a42c4f0842aa87e181a",
        "ODCID": "127ecc830d98f9d54a42c4f0842aa87e181a",
        "protocol_type":  "QUIC_HTTP3",
        "reference_time": "1553986553572"
    },
    "event_fields": [
        "relative_time",
        "category",
        "event",
        "data"
    ],
    "events": [[
            2,
            "transport",
            "packet_received",
            [...]
        ],[
            7,
            "http",
            "frame_parsed",
            [...]
        ],
        ...
    ]
}
</pre>
<p class="figure">Figure 4: qlog optimized JSON</p>
<p id="rfc.section.3.3.4.p.4">The main field names that can be included in these fields are defined in <a href="#field-name-semantics" class="xref">Section 3.4</a>.</p>
<p id="rfc.section.3.3.4.p.5">Given that qlog is intended to be a flexible format, unknown field names in both &#8220;common_fields&#8221; and &#8220;event_fields&#8221; MUST be disregarded by the user (i.e., the presence of an uknown field is explicitly NOT an error).</p>
<p id="rfc.section.3.3.4.p.6">This approach makes line-per-line logging easier and faster, as each log statement only needs to include the data for the events, not the field names. Events can also be logged and processed separately, as part of a contiguous event-stream.</p>
<h1 id="rfc.section.3.3.4.1">
<a href="#rfc.section.3.3.4.1">3.3.4.1.</a> <a href="#commonfields-format" id="commonfields-format">common_fields format</a>
</h1>
<p id="rfc.section.3.3.4.1.p.1">An object containing pairs of &#8220;field name&#8221;-&#8220;field value&#8221;. Fields included in &#8220;common_fields&#8221; indicate that these field values are the same for each event in the &#8220;events&#8221; array (with the exception of the &#8220;group_ids&#8221; field, see <a href="#group_ids" class="xref">Section 3.4.2</a>)</p>
<p id="rfc.section.3.3.4.1.p.2">If even one event in the trace does not adhere to this convention, that field name should be in &#8220;event_fields&#8221; instead, and the value logged per event. An alternative route is to include the most commonly seen value in &#8220;common_fields&#8221; and then include the deviating field value in the generic &#8220;data&#8221; field for each non-confirming event. However, these semantics are not defined in this document.</p>
<h1 id="rfc.section.3.3.4.2">
<a href="#rfc.section.3.3.4.2">3.3.4.2.</a> <a href="#eventfields-format" id="eventfields-format">event_fields format</a>
</h1>
<p id="rfc.section.3.3.4.2.p.1">An array of field names (plain strings). Field names included in &#8220;event_fields&#8221; indicate that these field names are present <strong>in this exact order</strong> for each event in the &#8220;events&#8221; array. Each individual event then only has to log the corresponding values for those fields in the correct order.</p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> <a href="#field-name-semantics" id="field-name-semantics">Field name semantics</a>
</h1>
<p id="rfc.section.3.4.p.1">This section lists pre-defined, reserved field names with specific semantics and expected corresponding value formats.</p>
<p id="rfc.section.3.4.p.2">Only a time-based field (see <a href="#time-based-fields" class="xref">Section 3.4.1</a>), the event field and the data field are mandatory. Typical setups will log reference_time, protocol_type and group_id in &#8220;common_fields&#8221; and relative_time, category, event and data in &#8220;event_fields&#8221;.</p>
<p id="rfc.section.3.4.p.3">Other field names are allowed, both in &#8220;common_fields&#8221; and &#8220;event_fields&#8221;, but their semantics depend on the context of the log usage (e.g., for QUIC, the ODCID field is used).</p>
<h1 id="rfc.section.3.4.1">
<a href="#rfc.section.3.4.1">3.4.1.</a> <a href="#time-based-fields" id="time-based-fields">time, delta_time and reference_time + relative_time</a>
</h1>
<p id="rfc.section.3.4.1.p.1">There are three main modes for logging time:</p>
<p></p>

<ul>
<li>Include the full timestamp with each event (&#8220;time&#8221;). This approach uses the largest amount of characters.</li>
<li>Delta-encode each time value on the previously logged value (&#8220;delta_time&#8221;).  The first event can log the full timestamp. This approach uses the least amount of characters.</li>
<li>Specify a full &#8220;reference_time&#8221; timestamp up-front in &#8220;common_fields&#8221; and include only relatively-encoded values based on this reference_time with each event (&#8220;relative_time&#8221;). This approach uses a medium amount of characters.</li>
</ul>
<p id="rfc.section.3.4.1.p.3">The first option is good for stateless loggers, the second and third for stateful loggers. The third option is generally preferred, since it produces smaller files while being easier to reason about.</p>
<div id="rfc.figure.5"></div>
<div id="time_approaches"></div>
<pre>
The time approach will use:
1500, 1505, 1522, 1588

The delta_time approach will use:
1500, 5, 17, 66

The relative_time approach will:
- set the reference_time to 1500 in "common_fields"
- use: 0, 5, 22, 88

</pre>
<p class="figure">Figure 5: Three different approaches for logging timestamps</p>
<h1 id="rfc.section.3.4.2">
<a href="#rfc.section.3.4.2">3.4.2.</a> <a href="#group_ids" id="group_ids">group_id and group_ids</a>
</h1>
<p id="rfc.section.3.4.2.p.1">A single Trace can contain events from a variety of sources, belonging to for example a number of individual QUIC connections. For tooling considerations, it is necessary to have a well-defined way to split up events belonging to different logical groups into subgroups for visualization and processing. For example, if one type of log uses 4-tuples as identifiers and uses a field name &#8220;four_tuple&#8221; and another uses &#8220;ODCID&#8221;, there is no way to know for generic tools which of these fields should be used to create subgroups. As such, qlog uses the generic &#8220;group_id&#8221; field to circumvent this issue.</p>
<p id="rfc.section.3.4.2.p.2">The &#8220;group_id&#8221; field can be any type of valid JSON object, but is typically a string or integer. For more complex use cases, the group_id could become a complex object with several fields (e.g., a 4-tuple). In those cases, it would be wasteful to log these values in full every single time. This would also complicate tool-based processing. As a solution, qlog allows the extraction of group_id values into a separate &#8220;group_ids&#8221; field in the &#8220;common_fields&#8221;, consisting of an array of the various present group ids for this trace. If this field is present, per-event &#8220;group_id&#8221; values are regarded as indices into the &#8220;group_ids&#8221; array.  This is useful if the group_ids are known up-front or the qlog trace can be generated from a more verbose format afterwards. If this is not the case, it is acceptable to just log the complex objects as the &#8220;group_id&#8221; for each event. Both use cases are demonstrated in <a href="#group_id_repeated" class="xref">Figure 6</a> and <a href="#group_id_indexed" class="xref">Figure 7</a>.</p>
<p id="rfc.section.3.4.2.p.3">Since &#8220;group_id&#8221; and &#8220;group_ids&#8221; are generic names, they convey little of the semantics to the casual reader. It is best practice to also include a per use case additional field to the &#8220;common_fields&#8221; with a semantic name, that has the same value as the &#8220;group_id&#8221; or &#8220;group_ids&#8221; field. For example, see the &#8220;ODCID&#8221; field in <a href="#qlog_json" class="xref">Figure 4</a> and the &#8220;four_tuples&#8221; field in <a href="#group_id_indexed" class="xref">Figure 7</a>.</p>
<p id="rfc.section.3.4.2.p.4">TODO: maybe just make group_ids or group_id reference the named field instead? e.g., &#8220;group_id&#8221;: &#8220;ODCID&#8221;</p>
<p id="rfc.section.3.4.2.p.5">TODO: for the simple use case (e.g., just 1 QUIC connection in the trace), MUST a trace include a group_id? maybe yes: the ODCID? (ODCID because the normal connection IDs can change during the QUIC connection).</p>
<div id="rfc.figure.6"></div>
<div id="group_id_repeated"></div>
<pre>
{
    "common_fields": {
        "protocol_type":  "QUIC_HTTP3",
    },
    "event_fields": [
        "time",
        "group_id",
        "category",
        "event",
        "data"
    ],
    "events": [[
            1553986553579,
            { "ip1": "2001:67c:1232:144:9498:6df6:f450:110b", "ip2": "2001:67c:2b0:1c1::198", "port1": 59105, "port2": 80 }
            "transport",
            "packet_received",
            [...]
        ],[
            1553986553588,
            { "ip1": "10.0.6.137", "ip2": "52.58.13.57", "port1": 56522, "port2": 443 }
            "http",
            "frame_parsed",
            [...]
        ],[
            1553986553598,
            { "ip1": "2001:67c:1232:144:9498:6df6:f450:110b", "ip2": "2001:67c:2b0:1c1::198", "port1": 59105, "port2": 80 }
            "transport",
            "packet_sent",
            [...]
        ],
        ...
    ]
}
</pre>
<p class="figure">Figure 6: Repeated complex group id</p>
<div id="rfc.figure.7"></div>
<div id="group_id_indexed"></div>
<pre>
{
    "common_fields": {
        "protocol_type":  "QUIC_HTTP3",
        "group_ids": [
            { "ip1": "2001:67c:1232:144:9498:6df6:f450:110b", "ip2": "2001:67c:2b0:1c1::198", "port1": 59105, "port2": 80 },
            { "ip1": "10.0.6.137", "ip2": "52.58.13.57", "port1": 56522, "port2": 443 }
        ],
        "four_tuples": [
            { "ip1": "2001:67c:1232:144:9498:6df6:f450:110b", "ip2": "2001:67c:2b0:1c1::198", "port1": 59105, "port2": 80 },
            { "ip1": "10.0.6.137", "ip2": "52.58.13.57", "port1": 56522, "port2": 443 }
        ]
    },
    "event_fields": [
        "time",
        "group_id",
        "category",
        "event",
        "data"
    ],
    "events": [[
            1553986553579,
            0,
            "transport",
            "packet_received",
            [...]
        ],[
            1553986553588,
            1,
            "http",
            "frame_parsed",
            [...]
        ],[
            1553986553598,
            0,
            "transport",
            "packet_sent",
            [...]
        ],
        ...
    ]
}
</pre>
<p class="figure">Figure 7: Indexed complex group id</p>
<h1 id="rfc.section.3.4.3">
<a href="#rfc.section.3.4.3">3.4.3.</a> <a href="#category-and-event" id="category-and-event">category and event</a>
</h1>
<p id="rfc.section.3.4.3.p.1">Both category and event are separate, generic strings. Category allows a higher-level grouping of events per event type.</p>
<p id="rfc.section.3.4.3.p.2">For example, instead of having an event of value &#8220;transport_packet_sent&#8221;, we instead have a category of &#8220;transport&#8221; and event type of &#8220;packet_sent&#8221;. This allows for fast and high-level filtering based on category and re-use of event across categories.</p>
<h1 id="rfc.section.3.4.4">
<a href="#rfc.section.3.4.4">3.4.4.</a> <a href="#data" id="data">data</a>
</h1>
<p id="rfc.section.3.4.4.p.1">The data field is a generic object (list of name-value pairs). It contains the per-event metadata and its form and semantics are defined per specific sort of event (typically per event, but possibly also by combination of category and event).</p>
<h1 id="rfc.section.3.4.5">
<a href="#rfc.section.3.4.5">3.4.5.</a> <a href="#event-field-values" id="event-field-values">Event field values</a>
</h1>
<p id="rfc.section.3.4.5.p.1">The specific values for each of these fields and their semantics are defined in separate documents, specific per protocol or use case.</p>
<p id="rfc.section.3.4.5.p.2">For example: event definitions for QUIC and HTTP/3 can be found in draft-marx-qlog-event-definitions-quic-h3.</p>
<h1 id="rfc.section.3.5">
<a href="#rfc.section.3.5">3.5.</a> <a href="#triggers" id="triggers">triggers</a>
</h1>
<p id="rfc.section.3.5.p.1">Sometimes, additional information is needed in the case where a single event can be caused by a variety of other events. In the normal case, the context of the surrounding log messages gives a hint as to which of these other events was the cause. However, in highly-parallel and optimized implementations, corresponding log messages might be wide and far between in time. Another option is to use triggers instead of logging extra full events to get more fine-grained information without much additional overhead.</p>
<p id="rfc.section.3.5.p.2">For this reason, qlog allows an optional &#8220;trigger&#8221; property on the value of the &#8220;data&#8221; field to convey such information. It indicates the reason this event occured. The possible reasons depend on the type of event and SHOULD be specified next to each event definition. Triggers can be of any type, but are typically logged as strings. For an example, see <a href="#trigger_example" class="xref">Figure 8</a>.</p>
<div id="rfc.figure.8"></div>
<div id="trigger_example"></div>
<pre>
{
    "common_fields": {
        "group_id": "127ecc830d98f9d54a42c4f0842aa87e181a",
        "ODCID": "127ecc830d98f9d54a42c4f0842aa87e181a",
        "protocol_type":  "QUIC_HTTP3",
        "reference_time": "1553986553572"
    },
    "event_fields": [
        "relative_time",
        "category",
        "event",
        "data"
    ],
    "events": [[
            20,
            "transport",
            "packet_received",
            [
                // Indicates that the packet wasn't received exactly now,
                // but instead had been buffered because there were no
                // appropriate TLS keys available to decrypt it before.
                "trigger": "keys_available",
                ...
            ]
        ],[
            27,
            "http",
            "frame_created",
            [
                // Indicates that this frame is being created in response
                // to an HTTP GET/POST/... request
                "trigger": "request",
                ...
            ]
        ],
        ...
    ]
}
</pre>
<p class="figure">Figure 8: Trigger example</p>
<p id="rfc.section.3.5.p.3">Note: previously, triggers were also top-level fields, similar to category, event and data itself. However, since many events don&#8217;t have specific triggers and some triggers are difficult to implement or keep track of in an implementation flow, it was decided to make &#8220;trigger&#8221; an optional property of the data field value instead.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#tooling-requirements" id="tooling-requirements">Tooling requirements</a>
</h1>
<p id="rfc.section.4.p.1">Tools MUST indicate which qlog version(s) they support. Additionally, they SHOULD indicate exactly which values for and properties of the category, event and data fields they look for to execute their logic. Tools SHOULD perform a (high-level) check if an input qlog file adheres to the expected qlog schema. If a tool determines a qlog file does not contain enough supported information to correctly execute the tool&#8217;s logic, it SHOULD generate a clear error message to this effect.</p>
<p id="rfc.section.4.p.2">Tools MUST not produce errors for any field names and values in the qlog format that they do not recognize. Tools CAN indicate unknown event occurences within their context (e.g., marking unknown events on a timeline for manual interpretation by the user).</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#methods-of-access" id="methods-of-access">Methods of Access</a>
</h1>
<p id="rfc.section.5.p.1">TBD : propose to use a .well-known URL to fetch logs from an endpoint / to send logs to.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#notes-on-practical-use" id="notes-on-practical-use">Notes on Practical Use</a>
</h1>
<p id="rfc.section.6.p.1">TBD : discuss that implementations do not have to output qlog directly. It is good practice to log in whatever way you want, and then just write a transformer to qlog for use in tooling.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a>
</h1>
<p id="rfc.section.7.p.1">TBD : discuss privacy and security considerations (e.g., what NOT to log, what to strip out of a log before sharing, &#8230;)</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a>
</h1>
<p id="rfc.section.8.p.1">TBD</p>
<h1 id="rfc.references">
<a href="#rfc.references">9.</a> Normative References</h1>
<table><tbody><tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr></tbody></table>
<h1 id="rfc.appendix.A">
<a href="#rfc.appendix.A">Appendix A.</a> <a href="#change-log" id="change-log">Change Log</a>
</h1>
<h1 id="rfc.appendix.A.1">
<a href="#rfc.appendix.A.1">A.1.</a> <a href="#since-draft-marx-qlog-main-schema-00" id="since-draft-marx-qlog-main-schema-00">Since draft-marx-qlog-main-schema-00:</a>
</h1>
<p></p>

<ul>
<li>All field names are now lowercase (e.g., category instead of CATEGORY)</li>
<li>Triggers are now properties on the &#8220;data&#8221; field value, instead of separate field types (#23)</li>
</ul>
<h1 id="rfc.appendix.B">
<a href="#rfc.appendix.B">Appendix B.</a> <a href="#design-variations" id="design-variations">Design Variations</a>
</h1>
<p></p>

<ul>
<li>
<a href="https://github.com/google/quic-trace">Quic-trace</a> takes a slightly different approach based on protocolbuffers.</li>
<li>
<a href="https://github.com/EricssonResearch/spindump">Spindump</a> also defines a custom text-based format for in-network measurements</li>
<li>
<a href="https://www.wireshark.org/">Wireshark</a> also has a QUIC dissector and its results can be transformed into a json output format using tshark.</li>
</ul>
<p id="rfc.section.B.p.2">The idea is that qlog is able to encompass the use cases for both of these alternate designs and that all tooling converges on the qlog standard.</p>
<h1 id="rfc.appendix.C">
<a href="#rfc.appendix.C">Appendix C.</a> <a href="#acknowledgements" id="acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.C.p.1">Thanks to Jana Iyengar, Brian Trammell, Dmitri Tikhonov, Stephen Petrides, Jari Arkko, Marcus Ihlar, Victor Vasiliev, Mirja K&#252;hlewind, Jeremy Lain&#233; and Lucas Pardue for their feedback and suggestions.</p>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Robin Marx</span> 
	  <span class="n hidden">
		<span class="family-name">Marx</span>
	  </span>
	</span>
	<span class="org vcardline">Hasselt University</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:robin.marx@uhasselt.be">robin.marx@uhasselt.be</a></span>

  </address>
</div>

</body>
</html>

